generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model User {
    id            Int                @id @default(autoincrement())
    firstName     String
    lastName      String
    email         String             @unique
    organizations OrganizationUser[]
    password      String
    createdAt     DateTime           @default(now())
}

model Organization {
    id         String             @id @default(cuid())
    name       String
    inviteCode String             @unique
    warehouse  Warehouse[]
    users      OrganizationUser[]
    items      Item[]
    createdAt  DateTime           @default(now())
    updatedAt  DateTime           @updatedAt
}

model Warehouse {
    id             String       @id @default(cuid())
    name           String
    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
    stocks         Stock[]
}

model Item {
    id             String       @id @default(cuid())
    name           String
    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
    stocks         Stock[]
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
}

model Stock {
    id          String    @id @default(cuid())
    unit        String?
    quantity    Int
    price       Decimal?
    itemId      String
    item        Item      @relation(fields: [itemId], references: [id], onDelete: Cascade)
    warehouseId String
    warehouse   Warehouse @relation(fields: [warehouseId], references: [id], onDelete: Cascade)
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @default(now()) @updatedAt
}

model OrganizationUser {
    id             Int          @id @default(autoincrement())
    userId         Int
    user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    organizationId String
    organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
    role           UserRole     @default(USER)
    createdAt      DateTime     @default(now())

    @@unique([userId, organizationId])
}

enum UserRole {
    USER
    OWNER
}
